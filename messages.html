<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Messages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f0f0;
      padding: 20px;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    .message {
      background: white;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 5px solid #3498db;
      border-radius: 4px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .message small {
      display: block;
      color: #777;
      margin-top: 5px;
    }
  </style>
</head>
<body>

  <h2>ðŸ“© Messages from Ara</h2>
  <div id="messageList"></div>

  <script>
    const currentUser = JSON.parse(localStorage.getItem("currentUser"));
    if (!currentUser || !currentUser.email) {
      alert("You must be logged in to view messages.");
      window.location.href = "login.html";
    }

    const chatLogs = JSON.parse(localStorage.getItem("chatLogs")) || [];

    // Filter messages sent to this user
    const myMessages = chatLogs.filter(msg => msg.to === currentUser.email);

    // Check for unread messages
    const unreadMessages = myMessages.filter(msg => msg.read !== true);
    if (unreadMessages.length > 0) {
      alert(`ðŸ”” You have ${unreadMessages.length} new message(s) from Ara`);
    }

    // Mark messages as read
    chatLogs.forEach(msg => {
      if (msg.to === currentUser.email) {
        msg.read = true;
      }
    });
    localStorage.setItem("chatLogs", JSON.stringify(chatLogs));

    const list = document.getElementById("messageList");
    if (myMessages.length === 0) {
      list.innerHTML = "<p>No messages yet.</p>";
    } else {
      myMessages.reverse().forEach(msg => {
        list.innerHTML += `
          <div class="message">
            <strong>Admin:</strong> ${msg.text}
            <small>${new Date(msg.time).toLocaleString()}</small>
          </div>`;
      });
    }
  </script>

</body>
</html>
